# =============================================================================
# ğŸ¬ MySQL ì„œë¹„ìŠ¤ ì •ì˜
# =============================================================================
# ğŸ“ ì„¤ëª…: MySQL ë°ì´í„°ë² ì´ìŠ¤ ì ‘ì†ì„ ìœ„í•œ ë„¤íŠ¸ì›Œí¬ ì„œë¹„ìŠ¤ ì •ì˜
# ğŸ¯ ëª©ì : ì•ˆì •ì ì¸ ë°ì´í„°ë² ì´ìŠ¤ ì ‘ì† ì—”ë“œí¬ì¸íŠ¸ ì œê³µ, ë¡œë“œë°¸ëŸ°ì‹±
# ğŸŒŸ ì‹¤ë¬´ íŒ: ClusterIP íƒ€ì…ìœ¼ë¡œ í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œë§Œ ì ‘ê·¼í•˜ë„ë¡ ë³´ì•ˆ ê°•í™”
# ğŸ”„ ì‹¤í–‰ ìˆœì„œ: #4-1-2 (PVC ìƒì„± í›„ ì‹¤í–‰)
# ğŸ“– ì°¸ê³ : https://kubernetes.io/docs/concepts/services-networking/service/
# =============================================================================

apiVersion: v1
kind: Service

metadata:
  name: mysql-service            # ì„œë¹„ìŠ¤ ì´ë¦„ (DNS ì´ë¦„ìœ¼ë¡œ ì‚¬ìš©ë¨)
  namespace: web3-community     # ì†Œì† ë„¤ì„ìŠ¤í˜ì´ìŠ¤
  
  labels:
    app: web3-community
    component: database
    database: mysql
    tier: data
    service-type: database
    environment: local
  
  annotations:
    description: "MySQL database service endpoint"
    created-by: "developer"
    # ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ë¥¼ ìœ„í•œ ì–´ë…¸í…Œì´ì…˜
    prometheus.io/scrape: "false"  # ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì§ì ‘ ëª¨ë‹ˆí„°ë§í•˜ì§€ ì•ŠìŒ

spec:
  # =============================================================================
  # ğŸŒ ì„œë¹„ìŠ¤ íƒ€ì…
  # =============================================================================
  # ClusterIP: í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥ (ë°ì´í„°ë² ì´ìŠ¤ìš©ìœ¼ë¡œ ì í•©)
  # NodePort: ì™¸ë¶€ì—ì„œë„ ì ‘ê·¼ ê°€ëŠ¥ (ê°œë°œ/ë””ë²„ê¹…ìš©)
  # LoadBalancer: ì™¸ë¶€ ë¡œë“œë°¸ëŸ°ì„œ í• ë‹¹ (ìš´ì˜ í™˜ê²½)
  type: ClusterIP
  
  # =============================================================================
  # ğŸ¯ ì…€ë ‰í„°: ì–´ë–¤ Podë¥¼ ì—°ê²°í• ì§€ ì§€ì •
  # =============================================================================
  # mysql-deployment.yamlì˜ labelsê³¼ ì¼ì¹˜í•´ì•¼ í•¨
  selector:
    app: mysql
    component: database
    tier: data
  
  # =============================================================================
  # ğŸ“¡ í¬íŠ¸ ì„¤ì •
  # =============================================================================
  ports:
    - name: mysql                 # í¬íŠ¸ ì´ë¦„ (ëª…í™•ì„±ì„ ìœ„í•´)
      protocol: TCP               # í”„ë¡œí† ì½œ íƒ€ì…
      port: 3306                 # ì„œë¹„ìŠ¤ì˜ í¬íŠ¸ (í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ ì ‘ì† í¬íŠ¸)
      targetPort: 3306           # ì»¨í…Œì´ë„ˆì˜ ì‹¤ì œ í¬íŠ¸
      # NodePort íƒ€ì…ì¼ ê²½ìš° ì£¼ì„ ì²˜ë¦¬: nodePort: 30306

# =============================================================================
# ğŸŒŸ ì„œë¹„ìŠ¤ ì ‘ì† ë°©ë²•
# =============================================================================
# 
# í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œ MySQL ì ‘ì†:
# - Hostname: mysql-service.web3-community.svc.cluster.local
# - Port: 3306
# - ê°„ë‹¨íˆ: mysql-service (ê°™ì€ ë„¤ì„ìŠ¤í˜ì´ìŠ¤)
# - ë‹¤ë¥¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤: mysql-service.web3-community
#
# Spring Boot application.yml ì„¤ì • ì˜ˆì‹œ:
# spring:
#   datasource:
#     url: jdbc:mysql://mysql-service:3306/web3_community
#     username: web3user
#     password: ${MYSQL_PASSWORD}
#
# ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì—ì„œ ì ‘ì† í…ŒìŠ¤íŠ¸:
# kubectl run mysql-client --image=mysql:8.0 --rm -it --restart=Never \
#   -- mysql -h mysql-service -u web3user -p
#
# ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸:
# kubectl get svc mysql-service -n web3-community
# kubectl describe svc mysql-service -n web3-community
# kubectl get endpoints mysql-service -n web3-community
#
# DNS í™•ì¸:
# kubectl run dns-test --image=busybox --rm -it --restart=Never \
#   -- nslookup mysql-service.web3-community
#
# ì‹¤ë¬´ íŒ:
# - ì„œë¹„ìŠ¤ ì´ë¦„ì€ ì˜ë¯¸ìˆê²Œ ì§“ê³  ì¼ê´€ì„± ìœ ì§€
# - ë°ì´í„°ë² ì´ìŠ¤ëŠ” ClusterIPë¡œ ì™¸ë¶€ ì ‘ì† ì°¨ë‹¨
# - í¬íŠ¸ ë²ˆí˜¸ëŠ” í‘œì¤€ í¬íŠ¸ ì‚¬ìš©ìœ¼ë¡œ í˜¼ë™ ë°©ì§€
# - ë¼ë²¨ë§ì„ í†µí•œ ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ ìš©ì´ì„± í™•ë³´
# =============================================================================