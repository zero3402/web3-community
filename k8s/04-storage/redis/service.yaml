# =============================================================================
# π”΄ Redis μ„λΉ„μ¤ μ •μ
# =============================================================================
# π“ μ„¤λ…: Redis μΈλ©”λ¨λ¦¬ λ°μ΄ν„°λ² μ΄μ¤ μ ‘μ†μ„ μ„ν• λ„¤νΈμ›ν¬ μ„λΉ„μ¤ μ •μ
# π― λ©μ : λΉ λ¥Έ μΊμ‹/μ„Έμ… μ¤ν† λ¦¬μ§€ μ ‘μ† μ—”λ“ν¬μΈνΈ μ κ³µ
# π μ‹¤λ¬΄ ν: Redisλ” λΉλ²ν• μ ‘μ†μ΄λ―€λ΅ μ•μ •μ μΈ λ„¤νΈμ›ν¬ μ„¤μ • μ¤‘μ”
# π”„ μ‹¤ν–‰ μμ„: #4-3-2 (PVC μƒμ„± ν›„ μ‹¤ν–‰)
# π“– μ°Έκ³ : https://kubernetes.io/docs/concepts/services-networking/service/
# =============================================================================

apiVersion: v1
kind: Service

metadata:
  name: redis-service             # μ„λΉ„μ¤ μ΄λ¦„
  namespace: web3-community     # μ†μ† λ„¤μ„μ¤νμ΄μ¤
  
  labels:
    app: web3-community
    component: database
    database: redis
    tier: data
    service-type: cache
    environment: local
  
  annotations:
    description: "Redis cache service endpoint"
    created-by: "developer"
    # Redis νΉν™” μ–΄λ…Έν…μ΄μ…
    prometheus.io/scrape: "false"

spec:
  type: ClusterIP                 # ν΄λ¬μ¤ν„° λ‚΄λ¶€ μ ‘μ†λ§ ν—μ©
  
  selector:
    app: redis
    component: database
    tier: data
  
  ports:
    - name: redis
      protocol: TCP
      port: 6379                 # Redis κΈ°λ³Έ ν¬νΈ
      targetPort: 6379

# =============================================================================
# π μ„λΉ„μ¤ μ ‘μ† λ°©λ²•
# =============================================================================
# 
# ν΄λ¬μ¤ν„° λ‚΄λ¶€μ—μ„ Redis μ ‘μ†:
# - Hostname: redis-service.web3-community.svc.cluster.local
# - Port: 6379
# - κ°„λ‹¨ν: redis-service (κ°™μ€ λ„¤μ„μ¤νμ΄μ¤)
#
# Spring Boot application.yml μ„¤μ • μμ‹:
# spring:
#   redis:
#     host: redis-service
#     port: 6379
#     password: ${REDIS_PASSWORD}
#     database: 0
#     timeout: 2000ms
#     lettuce:
#       pool:
#         max-active: 8
#         max-idle: 8
#         min-idle: 0
#
# μ ‘μ† ν…μ¤νΈ:
# kubectl run redis-client --image=redis:7.0 --rm -it --restart=Never \
#   -- redis-cli -h redis-service -p 6379
#
# Redis λ…λ Ήμ–΄ ν…μ¤νΈ:
# kubectl exec -it deployment/redis-deployment -n web3-community -- redis-cli
# > SET test-key "Hello Redis"
# > GET test-key
# > INFO memory
# > INFO stats
#
# λ¨λ‹ν„°λ§:
# kubectl exec deployment/redis-deployment -n web3-community -- redis-cli INFO
#
# μ‹¤λ¬΄ ν:
# - Redisλ” λΉλ²ν• μ ‘μ†μ΄λ―€λ΅ μ»¤λ„¥μ… ν’€ μµμ ν™”
# - λ©”λ¨λ¦¬ μ‚¬μ©λ‰ λ¨λ‹ν„°λ§ μ¤‘μ” (Eviction μ •μ±…)
# - μ΄μ ν™κ²½μ—μ„λ” Redis Cluster κ³ λ ¤
# - λ³΄μ•μ„ μ„ν•΄ λΉ„λ°€λ²νΈ μΈμ¦ ν•„μ
# - AOF/RDB λ°±μ—… μ „λµ μλ¦½
# =============================================================================