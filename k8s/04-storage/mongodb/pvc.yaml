# =============================================================================
# ğŸ’¾ MongoDB PersistentVolumeClaim
# =============================================================================
# ğŸ“ ì„¤ëª…: MongoDB ë°ì´í„° ì˜ì†ì„±ì„ ìœ„í•œ ë³¼ë¥¨ ìš”ì²­ ì •ì˜
# ğŸ¯ ëª©ì : ê²Œì‹œê¸€/ëŒ“ê¸€ ë°ì´í„°ê°€ Pod ì¬ì‹œì‘/ì´ë™ ì‹œì—ë„ ìœ ì§€ë˜ë„ë¡ ë³´ì¥
# ğŸŒŸ ì‹¤ë¬´ íŒ: MongoDBëŠ” I/O ì§‘ì•½ì ì´ë¯€ë¡œ SSD StorageClass ì‚¬ìš© ê¶Œì¥
# ğŸ”„ ì‹¤í–‰ ìˆœì„œ: #4-2-1 (MongoDB ë°°í¬ ì „ ì‹¤í–‰)
# ğŸ“– ì°¸ê³ : https://kubernetes.io/docs/concepts/storage/persistent-volumes/
# =============================================================================

apiVersion: v1
kind: PersistentVolumeClaim

metadata:
  name: mongodb-pvc              # PVC ì´ë¦„
  namespace: web3-community     # ì†Œì† ë„¤ì„ìŠ¤í˜ì´ìŠ¤
  
  labels:
    app: web3-community
    component: database
    database: mongodb
    tier: data
    environment: local
  
  annotations:
    description: "Persistent storage for MongoDB database"
    storage-class: "standard"
    created-by: "developer"
    # MongoDB íŠ¹í™” ì–´ë…¸í…Œì´ì…˜
    volume.beta.kubernetes.io/storage-class: "standard"

spec:
  # =============================================================================
  # ğŸ’¾ ìŠ¤í† ë¦¬ì§€ ì ‘ê·¼ ëª¨ë“œ
  # =============================================================================
  # ReadWriteOnce: ë‹¨ì¼ ë…¸ë“œì—ì„œ ì½ê¸°/ì“°ê¸° (MongoDB ë³µì œì…‹ ê¸°ì¤€)
  accessModes:
    - ReadWriteOnce
  
  # =============================================================================
  # ğŸ—ï¸ ìŠ¤í† ë¦¬ì§€ í´ë˜ìŠ¤
  # =============================================================================
  # ë¡œì»¬ ê°œë°œ í™˜ê²½ì˜ ê¸°ë³¸ StorageClass
  # ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ê³ ì„±ëŠ¥ SSD í´ë˜ìŠ¤ ì‚¬ìš© ê¶Œì¥
  storageClassName: "standard"
  
  # =============================================================================
  # ğŸ“Š ìŠ¤í† ë¦¬ì§€ ìš©ëŸ‰
  # =============================================================================
  resources:
    requests:
      storage: 15Gi              # 15GB ìŠ¤í† ë¦¬ì§€ ìš”ì²­ (ê²Œì‹œê¸€/ëŒ“ê¸€ ë°ì´í„° ê³ ë ¤)
      # ìš´ì˜ í™˜ê²½: 100Gi~1Ti ê¶Œì¥ (ë°ì´í„° ì„±ì¥ ì˜ˆì¸¡)

# =============================================================================
# ğŸŒŸ MongoDB íŠ¹í™” íŒ
# =============================================================================
# 
# ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•œ ì¶”ê°€ ì„¤ì •:
# - high-iops ìŠ¤í† ë¦¬ì§€ í´ë˜ìŠ¤ (NVMe SSD ê¶Œì¥)
# - ì ì ˆí•œ IOPS í”„ë¡œë¹„ì €ë‹ (1000-10000 IOPS)
# - ë””ìŠ¤í¬ ìºì‹œ ì •ì±… (write-back mode)
# - ì§€ì—­ë³„ ìŠ¤í† ë¦¬ì§€ ë¶„ë¦¬ (ì¬í•´ ë³µêµ¬)
#
# ëª¨ë‹ˆí„°ë§ ì§€í‘œ:
# - ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ (df -h)
# - IOPS ëŒ€ê¸° ì‹œê°„ (iostat)
# - ì“°ê¸° ì§€ì—° (MongoDB metrics)
#
# ìš´ì˜ í™˜ê²½ ê³ ë ¤ì‚¬í•­:
# - ë³µì œì…‹ êµ¬ì„± ì‹œ ê° ë©¤ë²„ë³„ PVC ìƒì„±
# - ë°±ì—… ìŠ¤í† ë¦¬ì§€ ë¶„ë¦¬ (cold storage)
# - ìŠ¤ëƒ…ìƒ· ì •ì±… ë° ë³´ê´€ ê¸°ê°„
# - ìš©ëŸ‰ í™•ì¥ ì „ëµ (ìˆ˜ì§/ìˆ˜í‰)
# =============================================================================