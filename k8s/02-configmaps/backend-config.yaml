# =============================================================================
# âš™ï¸ ë°±ì—”ë“œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì„¤ì • ë§µ
# =============================================================================
# ğŸ“ ì„¤ëª…: Spring Boot ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë“¤ì˜ ê³µí†µ ë° ê°œë³„ í™˜ê²½ ì„¤ì • ê´€ë¦¬
# ğŸ¯ ëª©ì : ì½”ë“œì™€ ì„¤ì • ë¶„ë¦¬, ì„œë¹„ìŠ¤ë³„ í™˜ê²½ ê´€ë¦¬, ì¤‘ì•™í™”ëœ ì„¤ì • ê´€ë¦¬
# ğŸ”’ ë³´ì•ˆ: ë¯¼ê° ì •ë³´ëŠ” Secretsì— ì €ì¥ (ì—¬ê¸°ëŠ” ê³µê°œ ì„¤ì •ë§Œ)
# ğŸŒŸ ì‹¤ë¬´ íŒ: ì„œë¹„ìŠ¤ë³„ ConfigMap ë¶„ë¦¬ ê´€ë¦¬ë¡œ ì˜í–¥ë„ ìµœì†Œí™”
# ğŸ”„ ì‹¤í–‰ ìˆœì„œ: #2-2 (ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ìƒì„± í›„ ì‹¤í–‰)
# ğŸ“– ì°¸ê³ : https://spring.io/guides/gs/spring-boot-for-kubernetes/
# =============================================================================

apiVersion: v1
kind: ConfigMap

metadata:
  name: backend-config
  namespace: web3-community
  
  labels:
    app: web3-community
    component: backend
    config-type: environment
    tier: application
  
  annotations:
    description: "Backend microservices configuration"
    config-version: "v1.0"

data:
  # =============================================================================
  # ğŸŒ ê³µí†µ Spring Boot ì„¤ì •
  # =============================================================================
  # ì• í”Œë¦¬ì¼€ì´ì…˜ ê¸°ë³¸ ì„¤ì •
  spring.profiles.active: "kubernetes"
  spring.application.name: "web3-community"
  
  # ì„œë²„ ì„¤ì •
  server.port: "8080"
  server.tomcat.max-threads: "200"
  server.tomcat.min-spare-threads: "10"
  
  # Actuator ì„¤ì • (ëª¨ë‹ˆí„°ë§ìš©)
  management.endpoints.web.exposure.include: "health,info,metrics,prometheus"
  management.endpoint.health.show-details: "always"
  management.metrics.export.prometheus.enabled: "true"
  
  # =============================================================================
  # ğŸ”— ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ ì„¤ì •
  # =============================================================================
  # Kubernetes ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬
  spring.cloud.kubernetes.discovery.enabled: "true"
  spring.cloud.kubernetes.discovery.all-namespaces: "false"
  spring.cloud.kubernetes.discovery.include-not-ready-addresses: "true"
  
  # =============================================================================
  # ğŸ“Š ë¡œê¹… ì„¤ì •
  # =============================================================================
  logging.level.root: "INFO"
  logging.level.org.springframework: "WARN"
  logging.level.org.springframework.web: "DEBUG"
  logging.level.org.springframework.reactive: "DEBUG"
  logging.level.web3.community: "DEBUG"
  
  # ë¡œê·¸ íŒ¨í„´ ì„¤ì •
  logging.pattern.console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
  
  # =============================================================================
  # ğŸš€ ì„±ëŠ¥ ìµœì í™” ì„¤ì •
  # =============================================================================
  # ì»¤ë„¥ì…˜ í’€ ê³µí†µ ì„¤ì •
  spring.datasource.hikari.maximum-pool-size: "20"
  spring.datasource.hikari.minimum-idle: "5"
  spring.datasource.hikari.idle-timeout: "300000"
  spring.datasource.hikari.pool-name: "Web3CommunityHikariCP"
  spring.datasource.hikari.max-lifetime: "1200000"
  
  # =============================================================================
  # ğŸŒ CORS ì„¤ì • (í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™ìš©)
  # =============================================================================
  cors.allowed.origins: "http://localhost:3000,http://localhost:30001"
  cors.allowed.methods: "GET,POST,PUT,DELETE,OPTIONS"
  cors.allowed.headers: "*"
  cors.allow-credentials: "true"
  cors.max-age: "3600"
  
  # =============================================================================
  # ğŸ“ API Gateway íŠ¹í™” ì„¤ì •
  # =============================================================================
  api.gateway.routes: |
    user-service:
      path: /api/users/**
      service-id: user-service
      strip-prefix: 2
    post-service:
      path: /api/posts/**
      service-id: post-service
      strip-prefix: 2
    comment-service:
      path: /api/comments/**
      service-id: comment-service
      strip-prefix: 2
    auth-service:
      path: /api/auth/**
      service-id: auth-service
      strip-prefix: 2
    notification-service:
      path: /api/notifications/**
      service-id: notification-service
      strip-prefix: 2
  
  # =============================================================================
  # ğŸ‘¤ User Service ì„¤ì •
  # =============================================================================
  user.service.database.schema: "web3_community"
  user.service.jwt.secret: "mysecretjwdkey123"
  user.service.jwt.expiration: "86400"
  user.service.password.encryption.key: "encryption-key-123"
  
  # =============================================================================
  # ğŸ“ Post Service ì„¤ì •
  # =============================================================================
  post.service.database.name: "web3_posts"
  post.service.max.post.length: "10000"
  post.service.max.title.length: "200"
  post.service.allowed.file.types: "jpg,jpeg,png,gif,pdf"
  post.service.max.file.size: "10MB"
  
  # =============================================================================
  # ğŸ’¬ Comment Service ì„¤ì •
  # =============================================================================
  comment.service.database.name: "web3_posts"
  comment.service.max.comment.length: "1000"
  comment.service.max.nesting.level: "5"
  comment.service.cache.ttl: "300"  # 5ë¶„
  
  # =============================================================================
  # ğŸ” Auth Service ì„¤ì •
  # =============================================================================
  auth.service.session.timeout: "3600"  # 1ì‹œê°„
  auth.service.max.login.attempts: "5"
  auth.service.lockout.duration: "1800"  # 30ë¶„
  auth.service.password.min.length: "8"
  auth.service.password.require.special.chars: "true"
  
  # =============================================================================
  # ğŸ”” Notification Service ì„¤ì •
  # =============================================================================
  notification.service.kafka.topics: "notifications,events,user-activity"
  notification.service.consumer.group.id: "notification-service"
  notification.service.batch.size: "100"
  notification.service.poll.timeout: "1000"
  
  # =============================================================================
  # ğŸ“¡ Kafka ê³µí†µ ì„¤ì •
  # =============================================================================
  kafka.bootstrap.servers: "kafka-service:9092"
  kafka.consumer.group.id: "web3-community"
  kafka.consumer.auto.offset.reset: "earliest"
  kafka.consumer.enable.auto.commit: "false"
  kafka.listener.ack.mode: "manual"
  kafka.producer.acks: "all"
  kafka.producer.retries: "3"
  
  # =============================================================================
  # ğŸ’¾ Redis ê³µí†µ ì„¤ì •
  # =============================================================================
  redis.host: "redis-service"
  redis.port: "6379"
  redis.database: "0"
  redis.timeout: "2000"
  redis.lettuce.pool.max-active: "8"
  redis.lettuce.pool.max-idle: "8"
  redis.lettuce.pool.min-idle: "0"
  
  # =============================================================================
  # ğŸ³ MongoDB ê³µí†µ ì„¤ì •
  # =============================================================================
  mongodb.host: "mongodb-service"
  mongodb.port: "27017"
  mongodb.database: "web3_posts"
  mongodb.username: "mongouser"
  mongodb.auto-index-creation: "true"
  
  # =============================================================================
  # ğŸ¬ MySQL ê³µí†µ ì„¤ì •
  # =============================================================================
  mysql.host: "mysql-service"
  mysql.port: "3306"
  mysql.database: "web3_community"
  mysql.username: "web3user"
  mysql.charset: "utf8mb4"
  mysql.connection-timeout: "30000"
  mysql.query-timeout: "60000"
  
  # =============================================================================
  # ğŸ¯ JVM íŠœë‹ ì„¤ì •
  # =============================================================================
  # ê³µí†µ JVM ì˜µì…˜ (ì„œë¹„ìŠ¤ë³„ë¡œ ì˜¤ë²„ë¼ì´ë“œ ê°€ëŠ¥)
  jvm.options.common: |
    -server
    -Xms256m
    -Xmx768m
    -XX:+UseG1GC
    -XX:MaxGCPauseMillis=200
    -XX:+UseContainerSupport
    -XX:MaxRAMPercentage=75.0
    -Djava.security.egd=file:/dev/./urandom
  
  # ì„œë¹„ìŠ¤ë³„ JVM ì˜µì…˜
  jvm.options.api-gateway: "${jvm.options.common} -Xmx512m"
  jvm.options.user-service: "${jvm.options.common} -Xmx768m"
  jvm.options.post-service: "${jvm.options.common} -Xmx512m"
  jvm.options.comment-service: "${jvm.options.common} -Xmx512m"
  jvm.options.auth-service: "${jvm.options.common} -Xmx256m"
  jvm.options.notification-service: "${jvm.options.common} -Xmx512m"

# =============================================================================
# ğŸ” ì„¤ëª… ë° ì‚¬ìš©ë²•
# =============================================================================
# 
# ì´ ConfigMap ì‚¬ìš© ë°©ë²•:
# 1. ì „ì²´ í™˜ê²½ ë³€ìˆ˜ë¡œ ì£¼ì…:
#    envFrom:
#      - configMapRef:
#          name: backend-config
#
# 2. íŠ¹ì • í‚¤ë§Œ í™˜ê²½ ë³€ìˆ˜ë¡œ ì£¼ì…:
#    env:
#      - name: SPRING_PROFILES_ACTIVE
#        valueFrom:
#          configMapKeyRef:
#            name: backend-config
#            key: spring.profiles.active
#
# 3. ì„¤ì • íŒŒì¼ë¡œ ë§ˆìš´íŠ¸:
#    volumeMounts:
#      - name: config-volume
#        mountPath: /app/config
#    volumes:
#      - name: config-volume
#        configMap:
#          name: backend-config
#
# ì‹¤ë¬´ íŒ:
# - ê³µí†µ ì„¤ì •ê³¼ ì„œë¹„ìŠ¤ë³„ ì„¤ì • ë¶„ë¦¬ ê´€ë¦¬
# - ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì •ë³´ëŠ” í™˜ê²½ë³„ë¡œ ë‹¤ë¥¸ ConfigMap ì‚¬ìš©
# - ì„¤ì • ë³€ê²½ ì‹œ Rollout ì „ëµìœ¼ë¡œ ë¬´ì¤‘ë‹¨ ë°°í¬ ê³ ë ¤
# - ConfigMap ë²„ì „ ê´€ë¦¬ë¡œ ë¡¤ë°± ìš©ì´í™”
# =============================================================================