<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                   http://www.liquibase.org/xml/ns/dbchangelog/db.changelog-4.0.xsd">

    <!-- Posts Table -->
    <changeSet id="create-posts-table" author="developer">
        <createTable tableName="posts">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="title" type="VARCHAR(200)">
                <constraints nullable="false"/>
            </column>
            <column name="content" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="author_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="category_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="featured_image_url" type="VARCHAR(500)"/>
            <column name="excerpt" type="TEXT"/>
            <column name="status" type="ENUM('DRAFT', 'PUBLISHED', 'ARCHIVED', 'DELETED')" defaultValue="DRAFT">
                <constraints nullable="false"/>
            </column>
            <column name="is_pinned" type="BOOLEAN" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="is_featured" type="BOOLEAN" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="view_count" type="BIGINT" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="like_count" type="BIGINT" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="comment_count" type="BIGINT" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="share_count" type="BIGINT" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="published_at" type="TIMESTAMP"/>
            <column name="created_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="updated_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="created_by" type="BIGINT"/>
            <column name="updated_by" type="BIGINT"/>
        </createTable>
        
        <addForeignKeyConstraint
            baseTableName="posts"
            baseColumnNames="author_id"
            referencedTableName="users"
            referencedColumnNames="id"
            constraintName="fk_posts_author_id"
            onDelete="CASCADE"/>
            
        <addForeignKeyConstraint
            baseTableName="posts"
            baseColumnNames="category_id"
            referencedTableName="categories"
            referencedColumnNames="id"
            constraintName="fk_posts_category_id"
            onDelete="RESTRICT"/>
            
        <createIndex tableName="posts" indexName="idx_posts_author_id">
            <column name="author_id"/>
        </createIndex>
        
        <createIndex tableName="posts" indexName="idx_posts_category_id">
            <column name="category_id"/>
        </createIndex>
        
        <createIndex tableName="posts" indexName="idx_posts_status">
            <column name="status"/>
        </createIndex>
        
        <createIndex tableName="posts" indexName="idx_posts_created_at">
            <column name="created_at"/>
        </createIndex>
        
        <createIndex tableName="posts" indexName="idx_posts_published_at">
            <column name="published_at"/>
        </createIndex>
        
        <createIndex tableName="posts" indexName="idx_posts_is_pinned">
            <column name="is_pinned"/>
        </createIndex>
        
        <createIndex tableName="posts" indexName="idx_posts_is_featured">
            <column name="is_featured"/>
        </createIndex>
        
        <createIndex tableName="posts" indexName="idx_posts_title">
            <column name="title"/>
        </createIndex>
    </changeSet>

</databaseChangeLog>